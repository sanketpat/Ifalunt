<html ng-app="iflaunt"><head><title>i Flaunt</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3-theme-blue-grey.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Open Sans", sans-serif}
</style>

<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-aria.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-messages.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.js"></script>
<link rel="stylesheet"
	href="https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.css">

<script src="./js/angular-route.min.js"></script>

<script src="./controller/app.js"></script>
<script src="./controller/sessionService.js"></script>

<script language="javascript">



app.directive('appFilereader', function($q) {
    var slice = Array.prototype.slice;

    return {
        restrict: 'A',
        require: '?ngModel',
        link: function(scope, element, attrs, ngModel) {
                if (!ngModel) return;

                ngModel.$render = function() {};

                element.bind('change', function(e) {
                    var element = e.target;

                    $q.all(slice.call(element.files, 0).map(readFile))
                        .then(function(values) {
                            if (element.multiple) ngModel.$setViewValue(values);
                            else ngModel.$setViewValue(values.length ? values[0] : null);
                        });

                    function readFile(file) {
                        var deferred = $q.defer();

                        var reader = new FileReader();
                        reader.onload = function(e) {
                            deferred.resolve(e.target.result);
                        };
                        reader.onerror = function(e) {
                            deferred.reject(e);
                        };
                        reader.readAsDataURL(file);

                        return deferred.promise;
                    }

                }); //change

            } //link
    }; //return
});


app.directive('ngFiles', ['$parse', function ($parse) {

    function fn_link(scope, element, attrs) {
        var onChange = $parse(attrs.ngFiles);
        element.on('change', function (event) {
            onChange(scope, { $files: event.target.files });
        });
    };

    return {
        link: fn_link
    }
} ]);




app.controller('ImageUploadDetails', function ($scope, $http, sessionService, $window) {
	if(sessionService.get('user')==null){
		$window.location.href = './index.html';
        
	}else{
		$scope.user=sessionService.get('user')
		$scope.Email=$scope.user;
	}
	  $scope.Logout = function () {
		  sessionService.destroy('user');
		  $window.location.href = './index.html';
	        	  
	  }
	  
	  
	  var formdata = new FormData();
	  $scope.getTheFiles = function ($files) {
	      angular.forEach($files, function (value, key) {
	          formdata.append(key, value);
	      });
	      formdata.append("username",sessionService.get('user'));
	      
	      
	  };
	
	  $scope.uploadFiles = function () {

		  
	        var request = {
	            method: 'POST',
	            url: '/photo/upload',
	            data: formdata,
	            headers: {
	                'Content-Type': undefined
	            }
	        };
	        var request1 = {
		            method: 'POST',
		            url: '/photo/add',
		            headers : {
                        'Content-Type' : 'application/json'
                    },
                    data : {
                        username : eamil,
                        password : password
                    }
		        };
	            

	        // SEND THE FILES.
	        $http(request)
	        .then(function(response) {
	                    // success callback
	                    if (response.status == 200 && response.data!="") {
	                        alert("Photo Uploaded Successfully");
	                    //    alert("Session Name"+sessionService.get('user'));
	                        
	                        $scope.photoname=response.data.photoName;
	                       // ./images/muraligowthamsb@gmail.com.jpg
	                      //  alert($scope.photoname);
	                        //$window.location.href = './profile-update.html';

	                    }
	                    else if (response.data=="") {
	                        alert("Incorrect Credentials ");
	                       
	                    }else {
	                        alert("Error: "
	                            + response.data.statusText);
	                    }
	                });
	        
	        
	     

	    }
	  
	
});

      </script> 
</head><body class="w3-theme-l5" ng-controller="ImageUploadDetails">
<form name="pic" enctype="multipart/form-data">
<!-- Navbar -->
<div class="w3-top">
 <ul class="w3-navbar w3-theme-d2 w3-left-align w3-large">
  <li class="w3-hide-medium w3-hide-large w3-opennav w3-right">
    <a class="w3-padding-large w3-hover-white w3-large w3-theme-d2" href="javascript:void(0);" onclick="openNav()"><i class="fa fa-bars"></i></a>
  </li>
  <li><a href="home.html" class="w3-padding-large w3-hover-white"><i class="fa fa-home w3-margin-right"></i>i Flaunt</a></li>
  
  <li class="w3-hide-small"><a href="FriendsRequest.html" class="w3-padding-large w3-hover-white"> Friends 
  <i class="fa fa-group"></i></a></li>
  <li class="w3-hide-small"><a href="ImageUpload.html" class="w3-padding-large w3-theme-d4" >Flaunt Now 
  <i class="fa fa-camera-retro"></i></a></li>
  <li class="w3-hide-small w3-dropdown-hover">
    <a href="TrendsNearby.html" class="w3-padding-large w3-hover-white" >Near By Trends
  <i class="	fa fa-street-view"></i></a>
  
  <li class="w3-hide-small w3-dropdown-hover">
    <a class="w3-padding-large w3-hover-white" ng-click="Logout()">Log Out
  <i class="fa fa-power-off"></i></a>
    
  </li>
  <li class="w3-hide-small w3-right"><a href="profile-update.html" class="w3-padding-large w3-hover-white" title="My Account"> {{user}} <img src="./images/avatar.png" class="w3-circle" style="height:25px;width:25px" alt="Avatar"></a></li>
 </ul>
</div>

<!-- Navbar on small screens -->
<div id="navDemo" class="w3-hide w3-hide-large w3-hide-medium w3-top w3-show" style="margin-top:51px">
  <ul class="w3-navbar w3-left-align w3-large w3-theme">
    <li><a class="w3-padding-large" href="FriendsRequest.html"> Friends <i class="fa fa-group"></i></a></li>
    <li><a class="w3-padding-large" href="ImageUpload.html">Flaunt Now <i class="fa fa-camera-retro"></i></a></li>
    <li><a class="w3-padding-large" href="TrendsNearby.html">Near By Trends <i class="	fa fa-street-view"></i></a></li>
    <li><a class="w3-padding-large" href="profile-update.html">My Profile <i class="fa fa-cog"></i></a></li>
    <li><a class="w3-padding-large" ng-click="Logout()">Log Out <i class="fa fa-power-off"></i></a></li>
  </ul>
</div>

<!-- Page Container -->
<div class="w3-container w3-content" style="max-width:1400px;margin-top:80px">
  <!-- The Grid -->
  <div class="w3-row">
    <!-- Left Column -->
    <div class="w3-col m3">
      <!-- Profile -->
      
      <br>
      
      <!-- Accordion -->
      
      <br>
      
      <!-- Interests -->
      <div class="w3-card-2 w3-round w3-white w3-hide-small">
        
      </div>
      <br>
      
      <!-- Alert Box -->
      
    
    <!-- End Left Column -->
    </div>
    
    <!-- Middle Column -->
    <div class="w3-col m7">
    
      <div class="w3-row-padding">
        <div class="w3-col m12">
          <div class="w3-card-2 w3-round w3-white">
            <div class="w3-container w3-padding">
              <h6 class="w3-opacity">Upload your Flaunt image</h6>
            
								<img ng-repeat="image in dummy.images | limitTo: 1" ng-src="{{dummy.images}}" class="img-responsive" alt="Cinque Terre" width="304" height="236" >
            
              <input type="file" id="file1" name="file"
							ng-files="getTheFiles($files)"  ng-model="dummy.images" accept="image/*"  app-filereader/>
							
							
							
               <br>
               Accessory: 
               <Select ng-model="Accessory" id="Accessory">
               <option>Shirt</option>
               <option>Trouser</option>
               <option>Shoe</option>
               </Select>
        
               
               Brand: <Select ng-model="BrandName1" id="Brand">
               <option>LP</option>
               <option>Levis</option>
               <option>Wrangler</option>
                <option>Indian Terrain</option>
               <option>Arrow</option>
                  <option>Zara</option>
               
               </Select>
               <br> 
                <br> 
              <button type="button" class="w3-btn w3-theme" ng-click="uploadFiles()"><i class="fa fa-upload"></i> &nbsp;Upload</button>
            </div>
          </div>
        </div>
      </div>
      
          
      
      
    <!-- End Middle Column -->
    </div>
    
    <!-- Right Column -->
    
    
  <!-- End Grid -->
  </div>
  
<!-- End Page Container -->
</div>
<br>

<!-- Footer -->



 
<script>
// Accordion
function myFunction(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-theme-d1";
    } else {
        x.className = x.className.replace("w3-show", "");
        x.previousElementSibling.className =
        x.previousElementSibling.className.replace(" w3-theme-d1", "");
    }
}

// Used to toggle the menu on smaller screens when clicking on the menu button
function openNav() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>


</form>

</body></html>